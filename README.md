# Работа с n-граммами: сбор и использование для оценки текста

## Сборка N-грамм

[CSharpModels/MutualInfo](https://github.com/Koziev/NGrams/tree/master/CSharpTools/MutualInfo) - проект на C# под VS 2015,
консольная утилита для сборки mutual information
по 2, 3 и 4-граммам из текстового корпуса. Результат работы содержит для каждой N-граммы
численную оценку того, насколько чаще слова употребляются рядом (в пределах заданного
окна), чем отдельно.

Чтобы не выходить за пределы памяти, доступной для штатных контейнеров .NET, программа
по мере достижения заданного количества накопленных N-грамм (опция -maxngrams) удаляет
записи с частотой 1 и сбрасывает текущую статистику в файл. Таким образом из статистики
устраняются самые редкие события и мусор.

В папке проекта лежат файлы ru2.cmd, ru3.cmd и ru4.cmd, выполняющие сборку mutual information
соответственно для 2, 3 и 4-грам. Готовый исполнимый файл, собранный для .NET Framework 4.5.2,
находится в подкаталоге bin.

Сбор статистики для пар слов:

```
MutualInfo.exe linkability2 -eols -o f:\tmp\mutual_info_2_ru.dat -maxngrams 20000000 -maxsentcount 10000000 -i f:\Corpus\word2vector\ru\SENTx.corpus.w2v.txt
```

В данном случае опция -i задает имя входного файла с текстом для обработки. Слова в этом
файле должны быть нормализованы - приведены к нижнему регистру, отделены друг от друга
пробелом. Каждая строка в этом файле содержит ровно одного предложение (опция -eols).
Я использую текстовый корпус, на котором обучается word2vec.

Результат сбора статистики будет сохранен в файле, задаваемом опцией -o.
Пример результата:

```
об	этом	0.00126763922162354
_num_	года	0.00113405147567391
может	быть	0.0010930981952697
_num_	году	0.00089808355551213
_num_	_num_	0.000855127000249922
у	него	0.000834500067867339
у	нас	0.000786542252171785
у	меня	0.000703341967891902
ничего	не	0.000655274430755526
потому	что	0.000640435784589499
что	то	0.000628835230600089
не	было	0.000616520526818931
самом	деле	0.000607113994192332
сих	пор	0.000597720616497099
в	этом	0.000584398920182139
таким	образом	0.000573453668039292
никогда	не	0.000540906621608883
кроме	того	0.000534450635313988
при	этом	0.000531821337062866
конце	концов	0.000508924305904657
```

Запуск сбора статистики (mutual information) для 3-грамм:

```
MutualInfo.exe linkability3 -eols -o f:\tmp\mutual_info_3_ru.dat -maxngrams 20000000 -maxsentcount 1000000 -i f:\Corpus\word2vector\ru\SENTx.corpus.w2v.txt
```

Пример результата:

```
о	том	что	0.00117650313768536
до	сих	пор	0.000910415546968579
в	конце	концов	0.000800392706878483
в	том	что	0.000692991074174643
по	крайней	мере	0.000687454885337502
для	того	чтобы	0.000649024383164942
на	самом	деле	0.000646147585939616
к	тому	же	0.000563509354833514
во	всяком	случае	0.000540249864570796
тем	не	менее	0.000532054458744824
после	того	как	0.000518217217177153
с	тех	пор	0.000427675055107102
в	то	время	0.000402327394112945
на	этот	раз	0.000397910305764526
в	том	числе	0.000391581299481913
в	самом	деле	0.000385362975066528
до	тех	пор	0.000361645012162626
тех	пор	пока	0.000360889593139291
в	этот	момент	0.000341905775712803
```
 
Запуск сбора статистики (mutual information) для 4-грамм:

```
set CORPUS=E:\Corpus\word2vector\ru\SENTx.corpus.w2v.txt
set RESULT=E:\tmp\mutual_information\mutual_info_4_ru.dat
MutualInfo.exe linkability4 -win 10 -fading 0.1 -eols -o %RESULT% -maxngrams 20000000 -maxsentcount 50000000 -i %CORPUS%
```

Пример результатов:

```
то	же	самое	и	0.000890194263774902
об	этом	тасс	в	0.000881558400578797
тем	не	менее	в	0.000859808176755905
сообщили	в	пресс	службе	0.000859305262565613
об	этом	говорится	в	0.000850802811328322
на	самом	деле	не	0.000842111476231366
так	же	как	и	0.000830422213766724
я	имею	в	виду	0.000820317829493433
не	только	но	и	0.000809311284683645
сдам	на	длительный	срок	0.000779413967393339
до	сих	пор	в	0.000762400100938976
по	сравнению	с	_num_	0.000758271606173366
тем	не	менее	не	0.000753793166950345
в	прошлом	году	_num_	0.000752096006181091
на	_num_	й	минуте	0.000751484476495534
на	_num_	_num_	руб	0.000746559002436697
и	до	сих	пор	0.000744594668503851
_num_	в	хорошем	состоянии	0.000742005940992385
в	_num_	_num_	млн	0.000737234076950699
об	этом	сообщили	пресс	0.000736980058718473
```


